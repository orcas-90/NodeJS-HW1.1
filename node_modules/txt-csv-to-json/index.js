var fs = require('fs');

exports.txtCsvToJSON = (flPath,regExp,func) =>{

    var flname = flPath;
    var colSeparator = /[,](?! )/;

    if(regExp)
    {
        colSeparator = regExp;
    }

    fs.exists(flname,function(exists){

        var jsonData = [];

        //Get File Data
            fs.readFile(flname,function(err, data){
                if(err){
                    return func(null, err);    
                }
                else
                {
                    var patt1 = /\r\n/;
                    var patt2 = colSeparator;
                    var csv_data = data.toString().split(patt1);
                    var headerRow = csv_data[0].split(patt2);
                    for(var row in csv_data)
                    { 
                        if(row > 0)
                        {
                            var jsonStr = "";
                            var cells = csv_data[row].split(patt2);
                            for(var i in cells)
                            {                   
                               if(i > 0)
                                {
                                     jsonStr = jsonStr + ",";
                                }
                                jsonStr = jsonStr + headerRow[i] + ": " + "'" + cells[i] + "'";
                                
                            }
                            if(jsonStr)
                            {
                                jsonData.push("{" + jsonStr + "}");
                            }
                            //console.log(jsonStr);
                        }
                        //console.log(csv_data[row]);
                    }
                    //console.log(csv_data);  
                    //console.log(jsonData.toString()); 
                    return func(jsonData, null);     
                }
            })
        
    })

}


